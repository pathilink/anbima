create table if not exists clean_values as
select -- only columns with a percentage of data other than 0 below 80%
	nquest,
	duration,
	pf2a,
	pf2b,
	pf2c,
	idade1,
	idade,
	sexo,
	p1,
	p1a,
	p2a,
	p3a,
	p5,
	p6,
	p7a,
	p7b,
	p8a,
	p8b,
	p8c,
	p8d,
	p8e,
	p8f,
	p8g,
	p8h,
	p8i,
	p8j,
	p8k,
	p9a,
	p11a,
	sorteio,
	p36aa,
	p36ca,
	p51a,
	p51b,
	p51aa,
	p51ab,
	rendaf,
	p57,
	p58,
	p59,
	p14a,
	p14aa,
	p52aa,
	p52ab,
	p38a,
	p38aa,
	p18a,
	p24a,
	p25,
	p40a,
	p55,
	pea,
	p27,
	p28,
	p29a,
	p29ca,
	p60,
	p61,
	p62,
	p63a,
	p63b,
	p64a,
	p64b,
	p64c,
	p64d,
	p64e,
	p64f,
	p64g,
	p64h,
	p64i,
	p64j,
	p64k,
	p64l,
	p65,
	p66,
	p33,
	internet,
	estcivil,
	nfilhos,
	idaa,
	idab,
	idac,
	carro,
	empreg,
	maqlav,
	dvd,
	banhe,
	gelad,
	freezer,
	comput,
	lavlou,
	microon,
	motocic,
	secadora,
	agua,
	rua,
	escolac,
	escola,
	renda,
	cor,
	genero,
	trans,
	orientsex,
	REGIAO,
	METROP,
	PORTE,
	CLASSE2,
	RCLASSE2,
	PESOE
from raw.values;

create table if not exists clean_labels as
select -- only columns with a percentage of data other than 0 below 80%
	nquest,
	duration,
	pf2a,
	pf2b,
	pf2c,
	idade1,
	idade,
	sexo,
	p1,
	p1a,
	p2a,
	p3a,
	p5,
	p6,
	p7a,
	p7b,
	p8a,
	p8b,
	p8c,
	p8d,
	p8e,
	p8f,
	p8g,
	p8h,
	p8i,
	p8j,
	p8k,
	p9a,
	p11a,
	sorteio,
	p36aa,
	p36ca,
	p51a,
	p51b,
	p51aa,
	p51ab,
	rendaf,
	p57,
	p58,
	p59,
	p14a,
	p14aa,
	p52aa,
	p52ab,
	p38a,
	p38aa,
	p18a,
	p24a,
	p25,
	p40a,
	p55,
	pea,
	p27,
	p28,
	p29a,
	p29ca,
	p60,
	p61,
	p62,
	p63a,
	p63b,
	p64a,
	p64b,
	p64c,
	p64d,
	p64e,
	p64f,
	p64g,
	p64h,
	p64i,
	p64j,
	p64k,
	p64l,
	p65,
	p66,
	p33,
	internet,
	estcivil,
	nfilhos,
	idaa,
	idab,
	idac,
	carro,
	empreg,
	maqlav,
	dvd,
	banhe,
	gelad,
	freezer,
	comput,
	lavlou,
	microon,
	motocic,
	secadora,
	agua,
	rua,
	escolac,
	escola,
	renda,
	cor,
	genero,
	trans,
	orientsex,
	REGIAO,
	METROP,
	PORTE,
	CLASSE2,
	RCLASSE2,
	PESOE
from raw.labels;

DO $$ 
DECLARE
    col TEXT;
    update_query TEXT := 'UPDATE clean_labels SET ';
BEGIN
    -- Loop pelas colunas de tipo TEXT na tabela
    FOR col IN 
        SELECT column_name 
        FROM information_schema.columns 
        WHERE table_name = 'clean_labels' 
          AND data_type IN ('text', 'character varying')
    LOOP
        -- Adiciona cada coluna à query de atualização
        update_query := update_query || format('%I = regexp_replace(%I, ''�'', '''', ''g''), ', col, col);
    END LOOP;

    -- Remover a última vírgula e executar o UPDATE
    update_query := left(update_query, length(update_query) - 2);
    EXECUTE update_query;
END $$;



